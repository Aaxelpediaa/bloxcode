<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Roblox Block Coding Prototype</title>
    <script src="./blockly_compressed.js"></script>
    <script src="./blocks_compressed.js"></script>
    <script src="./lua_compressed.js"></script>
    <script src="./en.js"></script>
    <style>
        body {
            background-color: #303030;
            color: #fff;
            font-family: sans-serif;
        }

        h1 {
            font-weight: normal;
            font-size: 140%;
        }
    </style>
</head>

<body>
    <img src="bloxcode-logo-truncated.png"
        style="margin-bottom: 30px; display: block; margin-left: auto; margin-right: auto" />
    <div id="connect_container">
        <label>
            Code:
        </label>
        <input type="text" id="code" placeholder="ABC123" />
        <button id="connect" onclick="onConnect()">Connect to Roblox Studio</button>
        <button onclick="showCode()">Show Lua</button>
    </div>

    <div id="controls" style="display: none">
        <select id="codefile" onchange="onCodefileChanged()">
            <option value="">Select a file</option>
        </select>

        <button onclick="saveToRoblox()">Save to Roblox Studio</button>
        <button onclick="newBloxScript()">New Blox Script</button>
        <button onclick="deleteBloxScript()">Delete Blox Script</button>
        <button onclick="refresh()">Refresh</button>
        <button onclick="showCode()">Show Lua</button>
    </div>
    <hr />

    <div id="blocklyDiv" style="height: 480px; width: 600px;"></div>

    <script type="text/javascript">
        const onResize = () => {
            const div = document.getElementById("blocklyDiv")
            div.style = `width: ${window.innerWidth - 10}px; height: ${window.innerHeight - 140}px;`
        }
        window.addEventListener("resize", onResize);
        onResize()
    </script>

    <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
        <category name="Logic" colour="%{BKY_LOGIC_HUE}">
            <block type="controls_if"></block>
            <block type="logic_compare"></block>
            <block type="logic_operation"></block>
            <block type="logic_negate"></block>
            <block type="logic_boolean"></block>
        </category>
        <category name="Loops" colour="%{BKY_LOOPS_HUE}">
            <block type="controls_repeat_ext">
                <value name="TIMES">
                    <block type="math_number">
                        <field name="NUM">10</field>
                    </block>
                </value>
            </block>
            <block type="controls_whileUntil"></block>
        </category>
        <category name="Math" colour="%{BKY_MATH_HUE}">
            <block type="math_number">
                <field name="NUM">123</field>
            </block>
            <block type="math_arithmetic"></block>
            <block type="math_single"></block>
            <block type="math_trig"></block>
            <block type="math_constant"></block>
            <block type="math_number_property"></block>
            <block type="math_round"></block>
            <block type="math_on_list"></block>
            <block type="math_modulo"></block>
            <block type="math_constrain">
                <value name="LOW">
                    <block type="math_number">
                        <field name="NUM">1</field>
                    </block>
                </value>
                <value name="HIGH">
                    <block type="math_number">
                        <field name="NUM">100</field>
                    </block>
                </value>
            </block>
            <block type="math_random_int">
                <value name="FROM">
                    <block type="math_number">
                        <field name="NUM">1</field>
                    </block>
                </value>
                <value name="TO">
                    <block type="math_number">
                        <field name="NUM">100</field>
                    </block>
                </value>
            </block>
            <block type="math_random_float"></block>
            <block type="math_atan2"></block>
        </category>
        <category name="Text" colour="%{BKY_TEXTS_HUE}">
            <block type="text"></block>
            <block type="text_length"></block>
            <block type="text_print"></block>
        </category>
        <category name="Variables" custom="VARIABLE" colour="%{BKY_VARIABLES_HUE}">

        </category>
        <category name="Local Variables">
            <block type="set_local_variable"></block>
        </category>
        <category name="Functions" custom="PROCEDURE" colour="%{BKY_PROCEDURES_HUE}">
        </category>
        <category name="Control">
            <block type="wait"></block>
        </category>
        <category name="Data">
            <block type="math_number">
                <field name="NUM">123</field>
            </block>
            <block type="vector3_new">
                <value name="X">
                    <block type="math_number">
                        <field name="NUM">0</field>
                    </block>
                </value>
                <value name="Y">
                    <block type="math_number">
                        <field name="NUM">0</field>
                    </block>
                </value>
                <value name="Z">
                    <block type="math_number">
                        <field name="NUM">0</field>
                    </block>
                </value>
            </block>
        </category>
        <category name="Instance">
            <block type="instance_new"></block>
            <block type="instance_new_with_parent"></block>
            <block type="instance_find_first_child">
                <value name="NAME">
                    <block type="text">
                        <field name="TEXT">Child</field>
                    </block>
                </value>
            </block>
            <block type="instance_wait_for_child">
                <value name="NAME">
                    <block type="text">
                        <field name="TEXT">Child</field>
                    </block>
                </value>
            </block>
            <block type="instance_destroy"></block>
            <block type="instance_is_a"></block>
            <block type="instance_get_parent"></block>
            <block type="instance_set_parent"></block>
            <block type="instance_get_archivable"></block>
            <block type="instance_set_archivable">
                <value name="VALUE">
                    <block type="logic_boolean">
                        <field name="BOOL">TRUE</field>
                    </block>
                </value>
            </block>
            <block type="instance_clone"></block>
        </category>
        <category name="Part">
            <block type="part_set_brickcolor"></block>
            <block type="part_event_connect"></block>
            <block type="part_get_position"></block>
            <block type="part_set_position">
                <value name="POSITION">
                    <block type="vector3_new">
                        <value name="X">
                            <block type="math_number">
                                <field name="NUM">0</field>
                            </block>
                        </value>
                        <value name="Y">
                            <block type="math_number">
                                <field name="NUM">0</field>
                            </block>
                        </value>
                        <value name="Z">
                            <block type="math_number">
                                <field name="NUM">0</field>
                            </block>
                        </value>
                    </block>
                </value>
            </block>
            <block type="part_get_cframe"></block>
            <block type="part_set_cframe"></block>
        </category>
        <category name="Humanoid">
            <block type="humanoid_set_scale">
                <value name="NAME">
                    <block type="math_number">
                        <field name="NUM">1.0</field>
                    </block>
                </value>

            </block>
            <block type="humanoid_get_scale"></block>
        </category>
        <category name="Body Movers">
            <category name="BodyPosition">
                <block type="part_get_position">
                    <field name="PART">pos</field>
                </block>
                <block type="part_set_position">
                    <field name="PART">pos</field>
                    <value name="POSITION">
                        <block type="vector3_new">
                            <value name="X">
                                <block type="math_number">
                                    <field name="NUM">0</field>
                                </block>
                            </value>
                            <value name="Y">
                                <block type="math_number">
                                    <field name="NUM">0</field>
                                </block>
                            </value>
                            <value name="Z">
                                <block type="math_number">
                                    <field name="NUM">0</field>
                                </block>
                            </value>
                        </block>
                    </value>
                </block>
                <block type="bodyposition_set_p">
                    <value name="NAME">
                        <block type="math_number">
                            <field name="NUM">10000</field>
                        </block>
                    </value>
                </block>
            </category>
            <category name="BodyGyro">
                <block type="part_get_cframe">
                    <field name="PART">rot</field>
                </block>
                <block type="part_set_cframe">
                    <field name="PART">rot</field>
                </block>
            </category>
        </category>
    </xml>

    <script>
        var demoWorkspace = Blockly.inject('blocklyDiv', {
            media: '../../media/',
            toolbox: document.getElementById('toolbox')
        });
        demoWorkspace.setTheme(Blockly.Themes.Dark)
            // Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),
            //                            demoWorkspace);
    </script>
    <script src="blocks.js"></script>
    <script src="sync.js"></script>

</body>

</html>